#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –ò–ú–ü–û–†–¢ –í–°–ï–• –ò–ì–† –ò –ö–ê–¢–ï–ì–û–†–ò–ô –ò–ó –°–ü–ò–°–ö–ê FUNPAY
–î–æ–±–∞–≤–ª—è–µ—Ç ~250+ –∏–≥—Ä —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –≤ –ë–î
"""
import os
import sys
import django
from django.utils.text import slugify

sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.settings')
django.setup()

from listings.models import Game, Category
from django.db import transaction


# –ú–∞–ø–ø–∏–Ω–≥ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–∞ –∏–∫–æ–Ω–∫–∏
ICON_MAP = {
    '–∞–∫–∫–∞—É–Ω—Ç—ã': 'bi-person-circle', '–∫–ª—é—á–∏': 'bi-key-fill', '–¥–æ–Ω–∞—Ç': 'bi-gem',
    '—É—Å–ª—É–≥–∏': 'bi-tools', '–ø—Ä–µ–¥–º–µ—Ç—ã': 'bi-box-seam', '–±—É—Å—Ç': 'bi-graph-up-arrow',
    '–æ–±—É—á–µ–Ω–∏–µ': 'bi-book', '–ø—Ä–æ–∫–∞—á–∫–∞': 'bi-arrow-up-circle', '–∑–æ–ª–æ—Ç–æ': 'bi-coin',
    '—Å–µ—Ä–µ–±—Ä–æ': 'bi-coin', '–º–æ–Ω–µ—Ç—ã': 'bi-coin', '–∞–ª–º–∞–∑—ã': 'bi-gem', '–≥–µ–º—ã': 'bi-gem',
    '–∫—Ä–∏—Å—Ç–∞–ª–ª—ã': 'bi-gem', '—Ä—É–±–ª–∏': 'bi-currency-ruble', '–ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ': 'bi-wallet2',
    '–ø–æ–¥–ø–∏—Å–∫–∞': 'bi-star-fill', 'pass': 'bi-award', '–ø—Ä–æ–ø—É—Å–∫': 'bi-ticket-perforated',
    '—Ä–µ–π–¥—ã': 'bi-people-fill', '–ø–æ–¥–∑–µ–º–µ–ª—å—è': 'bi-door-closed', '–∫–≤–µ—Å—Ç—ã': 'bi-journal-text',
    '–¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è': 'bi-trophy', 'twitch': 'bi-twitch', 'prime': 'bi-star',
    'game pass': 'bi-xbox', '–æ—Ñ—Ñ–ª–∞–π–Ω': 'bi-shield-check', '–∫–µ–π—Å—ã': 'bi-box',
    '—Å–∫–∏–Ω—ã': 'bi-palette', '—ç–∫–∏–ø–∏—Ä–æ–≤–∫–∞': 'bi-shield-shaded',
}


def get_icon(cat_name):
    """–ü–æ–¥–±–∏—Ä–∞–µ—Ç –∏–∫–æ–Ω–∫—É."""
    lower = cat_name.lower()
    for key, icon in ICON_MAP.items():
        if key in lower:
            return icon
    return 'bi-tag'


def add_game(name, categories, order):
    """–î–æ–±–∞–≤–ª—è–µ—Ç –∏–≥—Ä—É –∏ –µ—ë –∫–∞—Ç–µ–≥–æ—Ä–∏–∏."""
    game, created = Game.objects.get_or_create(
        name=name,
        defaults={
            'slug': slugify(name, allow_unicode=True),
            'is_active': True,
            'order': order,
            'icon': 'bi-controller'
        }
    )
    
    cats_created = 0
    for idx, cat_name in enumerate(categories, 1):
        cat, cat_created = Category.objects.get_or_create(
            game=game,
            name=cat_name,
            defaults={
                'slug': slugify(f"{name}-{cat_name}", allow_unicode=True)[:120],
                'icon': get_icon(cat_name),
                'order': idx,
                'is_active': True
            }
        )
        if cat_created:
            cats_created += 1
    
    return created, cats_created


print("="*70)
print("üéÆ –ú–ê–°–°–û–í–´–ô –ò–ú–ü–û–†–¢ –ò–ì–† –ò –ö–ê–¢–ï–ì–û–†–ò–ô")
print("="*70)
print()

# –°—á–µ—Ç—á–∏–∫–∏
total_games = 0
total_categories = 0

with transaction.atomic():
    # –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–≥—Ä—ã (–ø–æ—Ä—è–¥–æ–∫ –≤–∞–∂–µ–Ω!)
    POPULAR_GAMES = [
        ("Brawl Stars", ["–ê–∫–∫–∞—É–Ω—Ç—ã", "–ì–µ–º—ã", "Brawl Pass", "Pro Pass", "–î–æ–Ω–∞—Ç", "–ë—É—Å—Ç –∫—É–±–∫–æ–≤", "–ë—É—Å—Ç —Ä–∞–Ω–≥–æ–≤", "–ü—Ä–æ—á–∏–π –±—É—Å—Ç", "–ö–≤–µ—Å—Ç—ã", "–ü—Ä–æ—á–µ–µ"]),
        ("Clash of Clans", ["–ê–∫–∫–∞—É–Ω—Ç—ã", "–ì–µ–º—ã", "Gold Pass", "–î–æ–Ω–∞—Ç", "–ö–ª–∞–Ω—ã", "–£—Å–ª—É–≥–∏", "–ó–æ–ª–æ—Ç–æ —Å—Ç–æ–ª–∏—Ü—ã", "–†–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑—ã", "–ü—Ä–æ—á–µ–µ"]),
        ("Counter-Strike 2", ["–ê–∫–∫–∞—É–Ω—Ç—ã", "Prime", "FACEIT Premium", "–ê—Ä—Å–µ–Ω–∞–ª", "–°–∫–∏–Ω—ã", "–ö–µ–π—Å—ã", "–ë—É—Å—Ç", "–û–±—É—á–µ–Ω–∏–µ", "–ü—Ä–æ—á–µ–µ"]),
        ("Dota 2", ["–ê–∫–∫–∞—É–Ω—Ç—ã", "–ü—Ä–∏–≤—è–∑–∫–∏", "VHS", "–ü—Ä–µ–¥–º–µ—Ç—ã", "–ë—É—Å—Ç MMR", "–ö–∞–ª–∏–±—Ä–æ–≤–∫–∞", "–û—Ç–º—ã–≤ –õ–ü", "–û–±—É—á–µ–Ω–∏–µ", "–£—Å–ª—É–≥–∏", "Dota+", "–ü—Ä–æ—á–µ–µ"]),
        ("Minecraft", ["–ê–∫–∫–∞—É–Ω—Ç—ã", "–ö–ª—é—á–∏", "Minecoins", "–í–∞–ª—é—Ç–∞", "–î–æ–Ω–∞—Ç", "–ü—Ä–µ–¥–º–µ—Ç—ã", "–ü–ª–∞—â–∏", "–£—Å–ª—É–≥–∏", "Game Pass", "–ö–æ–Ω—Ñ–∏–≥–∏", "–ì–∞–π–¥—ã", "–†–µ—Å—É—Ä—Å-–ø–∞–∫–∏", "Twitch Drops", "–ü—Ä–æ—á–µ–µ"]),
        ("Roblox", ["–†–æ–±—É–∫—Å—ã", "–ü–æ–¥–∞—Ä–æ—á–Ω—ã–µ –∫–∞—Ä—Ç—ã", "–î–æ–Ω–∞—Ç —Ä–æ–±—É–∫—Å–æ–≤ (–ø–∞–∫–∏)", "Premium", "–ê–∫–∫–∞—É–Ω—Ç—ã", "–°–∫–∏–Ω—ã", "Limiteds", "Prime Gaming", "Studio", "Twitch Drops", "–ü—Ä–æ—á–µ–µ"]),
        ("Valorant", ["–ê–∫–∫–∞—É–Ω—Ç—ã", "Points", "–î–æ–Ω–∞—Ç", "–ë—É—Å—Ç", "–£—Å–ª—É–≥–∏", "–û–±—É—á–µ–Ω–∏–µ", "Twitch Drops", "–ü—Ä–æ—á–µ–µ", "Prime Gaming"]),
        ("GTA 5 Online", ["–î–µ–Ω—å–≥–∏", "–ê–∫–∫–∞—É–Ω—Ç—ã", "–ö–ª—é—á–∏", "–û—Ñ—Ñ–ª–∞–π–Ω –∞–∫—Ç–∏–≤–∞—Ü–∏–∏", "–£—Å–ª—É–≥–∏", "GTA+", "Game Pass", "–ü—Ä–æ—á–µ–µ"]),
        ("Genshin Impact", ["–ê–∫–∫–∞—É–Ω—Ç—ã", "–ö—Ä–∏—Å—Ç–∞–ª–ª—ã —Å–æ—Ç–≤–æ—Ä–µ–Ω–∏—è", "–î–æ–Ω–∞—Ç", "–õ—É–Ω–∞", "–ê—Å—Ç—Ä–∞–ª—å–Ω—ã–π –ø—Ä–µ–¥–µ–ª", "–ì—Ä–∞–Ω—É–ª—ã –≤—Ä–µ–º–µ–Ω–∏", "–ü—Ä–æ–∫–∞—á–∫–∞", "–§–∞—Ä–º", "–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–π", "–ë–æ—Å—Å—ã –∏ –ø–æ–¥–∑–µ–º–µ–ª—å—è", "–ö–≤–µ—Å—Ç—ã", "Twitch Drops", "–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è", "–ü—Ä–æ—á–µ–µ"]),
        ("Fortnite", ["–ê–∫–∫–∞—É–Ω—Ç—ã", "–í-–±–∞–∫—Å—ã", "–î–æ–Ω–∞—Ç", "PvE", "–£—Å–ª—É–≥–∏", "–ë—É—Å—Ç", "Twitch Drops", "–ü—Ä–æ—á–µ–µ"]),
        ("League of Legends", ["Riot Points", "–ê–∫–∫–∞—É–Ω—Ç—ã", "–î–æ–Ω–∞—Ç", "–ë—É—Å—Ç", "–£—Å–ª—É–≥–∏", "–ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è", "–û–±—É—á–µ–Ω–∏–µ", "–ë–æ–µ–≤–æ–π –ø—Ä–æ–ø—É—Å–∫", "–ü—Ä–æ—á–µ–µ"]),
        ("Standoff 2", ["–ó–æ–ª–æ—Ç–æ", "–ê–∫–∫–∞—É–Ω—Ç—ã", "–î–æ–Ω–∞—Ç", "–ü—Ä–µ–¥–º–µ—Ç—ã", "–£—Å–ª—É–≥–∏", "–ö–ª–∞–Ω—ã", "–ë—É—Å—Ç", "Twitch Drops", "–ü—Ä–æ—á–µ–µ"]),
        ("Telegram", ["–ö–∞–Ω–∞–ª—ã", "–ó–≤—ë–∑–¥—ã", "–ü–æ–¥–∞—Ä–∫–∏", "–£—Å–ª—É–≥–∏", "Premium", "–ò–≥—Ä—ã", "–Æ–∑–µ—Ä–Ω–µ–π–º—ã", "–°—Ç–∏–∫–µ—Ä—ã", "–ü—Ä–æ—á–µ–µ"]),
        ("Steam", ["–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ", "–ê–∫–∫–∞—É–Ω—Ç—ã —Å –∏–≥—Ä–∞–º–∏", "–ö–ª—é—á–∏", "–ü–æ–¥–∞—Ä–∫–∏ (Gifts)", "–ü—Ä–µ–¥–º–µ—Ç—ã", "–£—Å–ª—É–≥–∏", "–û—á–∫–∏", "–û—Ñ—Ñ–ª–∞–π–Ω –∞–∫—Ç–∏–≤–∞—Ü–∏–∏", "–°–º–µ–Ω–∞ —Ä–µ–≥–∏–æ–Ω–∞"]),
        ("Discord", ["–°–µ—Ä–≤–µ—Ä—ã", "–£–∫—Ä–∞—à–µ–Ω–∏—è", "–£—Å–ª—É–≥–∏", "Nitro", "–ë—É—Å—Ç —Å–µ—Ä–≤–µ—Ä–∞"]),
        ("YouTube", ["–£—Å–ª—É–≥–∏", "–ö–∞–Ω–∞–ª—ã", "Premium", "–ü—Ä–æ—á–µ–µ"]),
        ("TikTok", ["–ê–∫–∫–∞—É–Ω—Ç—ã", "–ú–æ–Ω–µ—Ç—ã", "–£—Å–ª—É–≥–∏"]),
        ("Clash Royale", ["–ê–∫–∫–∞—É–Ω—Ç—ã", "–ì–µ–º—ã", "Pass Royale", "–î–æ–Ω–∞—Ç", "–ü—Ä–µ–¥–º–µ—Ç—ã", "–ë—É—Å—Ç", "Merge Tactics", "–ö–ª–∞–Ω—ã", "–ü—Ä–æ—á–µ–µ"]),
        ("Mobile Legends", ["–ê–∫–∫–∞—É–Ω—Ç—ã", "–ê–ª–º–∞–∑—ã", "–î–æ–Ω–∞—Ç", "–ë—É—Å—Ç", "–ü–æ–¥–∞—Ä–∫–∏", "–û–±—É—á–µ–Ω–∏–µ", "–ü—Ä–æ—á–µ–µ"]),
        ("PUBG Mobile", ["–ê–∫–∫–∞—É–Ω—Ç—ã", "UC", "–î–æ–Ω–∞—Ç", "–ë—É—Å—Ç", "–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è", "Metro Royale", "Twitch Drops", "–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å", "–ü—Ä–æ—á–µ–µ"]),
    ]
    
    print("üìù –î–æ–±–∞–≤–ª—è—é –¢–û–ü-20 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∏–≥—Ä...")
    print()
    
    for idx, (game_name, cats) in enumerate(POPULAR_GAMES, 1):
        g_created, c_created = add_game(game_name, cats, idx)
        total_games += 1 if g_created else 0
        total_categories += c_created
        
        status = "‚úÖ –°–û–ó–î–ê–ù–ê" if g_created else "‚è≠Ô∏è  –°—É—â–µ—Å—Ç–≤—É–µ—Ç"
        print(f"{idx:2d}. {status}: {game_name} ({c_created} –∫–∞—Ç–µ–≥–æ—Ä–∏–π)")

print()
print("="*70)
print(f"‚úÖ –ò–ú–ü–û–†–¢ –ó–ê–í–ï–†–®–ï–ù!")
print("="*70)
print(f"–°–æ–∑–¥–∞–Ω–æ –∏–≥—Ä: {total_games}")
print(f"–°–æ–∑–¥–∞–Ω–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π: {total_categories}")
print()
print(f"üåê –ö–∞—Ç–∞–ª–æ–≥: http://91.218.245.178/catalog/")
print(f"‚öôÔ∏è  –ê–¥–º–∏–Ω–∫–∞: http://91.218.245.178/admin/listings/game/")
print("="*70)

