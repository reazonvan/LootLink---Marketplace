{% extends 'base.html' %}

{% block title %}Сообщения - LootLink{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>Мои сообщения</h1>
        <p class="text-muted">Беседы с продавцами и покупателями</p>
    </div>

    {% if conversations %}
    <div class="conversations-list">
        {% for conversation in conversations %}
        <a href="{% url 'chat:conversation_detail' conversation.pk %}" class="conversation-item {% if conversation.unread_count > 0 %}unread{% endif %}">
            <div class="conversation-avatar">
                {% if conversation.other_user.profile.avatar %}
                <img src="{{ conversation.other_user.profile.avatar.url }}" alt="{{ conversation.other_user.username }}">
                {% else %}
                <div class="avatar-placeholder">
                    <i class="bi bi-person-fill"></i>
                </div>
                {% endif %}
            </div>
            <div class="conversation-content">
                <div class="conversation-header">
                    <h5 class="conversation-username">{{ conversation.other_user.username }}</h5>
                    {% if conversation.unread_count > 0 %}
                    <span class="unread-badge">{{ conversation.unread_count }}</span>
                    {% endif %}
                </div>
                {% if conversation.listing %}
                <p class="conversation-listing">{{ conversation.listing.title }}</p>
                {% endif %}
                {% if conversation.last_message %}
                <p class="conversation-preview">
                    <strong>{% if conversation.last_message.sender == user %}Вы:{% endif %}</strong>
                    {{ conversation.last_message.content|truncatewords:10 }}
                </p>
                {% else %}
                <p class="conversation-preview text-muted">
                    Нет сообщений
                </p>
                {% endif %}
                <span class="conversation-time">{{ conversation.updated_at|date:"d.m.Y H:i" }}</span>
            </div>
        </a>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <i class="bi bi-chat-left-text"></i>
        <h4 class="mt-3">У вас пока нет бесед</h4>
        <p class="text-muted">Начните общение с продавцом через страницу объявления</p>
        <a href="{% url 'listings:catalog' %}" class="btn btn-primary mt-3">
            К каталогу
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}
