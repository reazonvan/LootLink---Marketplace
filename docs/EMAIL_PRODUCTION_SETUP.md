# üìß –ù–ê–°–¢–†–û–ô–ö–ê EMAIL –î–õ–Ø PRODUCTION

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: –ë–ï–ó –≠–¢–û–ì–û –°–ê–ô–¢ –ù–ï –ë–£–î–ï–¢ –†–ê–ë–û–¢–ê–¢–¨ –ü–û–õ–ù–û–¶–ï–ù–ù–û!

Email –Ω—É–∂–µ–Ω –¥–ª—è:
- ‚úâÔ∏è –°–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
- ‚úâÔ∏è –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ email
- ‚úâÔ∏è –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –ø–æ–∫—É–ø–∫–∞—Ö/–ø—Ä–æ–¥–∞–∂–∞—Ö
- ‚úâÔ∏è –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ï –ü–†–û–í–ê–ô–î–ï–†–´ –î–õ–Ø –†–û–°–°–ò–ò

### 1. üìÆ YANDEX MAIL (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ 500 –ø–∏—Å–µ–º/–¥–µ–Ω—å
- ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–ª—è–µ–º–æ—Å—Ç—å –≤ –†–æ—Å—Å–∏–∏
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- ‚úÖ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**

1. **–°–æ–∑–¥–∞–π—Ç–µ Yandex –∞–∫–∫–∞—É–Ω—Ç:**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://mail.yandex.ru
   - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å (–Ω–∞–ø—Ä–∏–º–µ—Ä: lootlink@yandex.ru)

2. **–í–∫–ª—é—á–∏—Ç–µ "–ü–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π":**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ: https://id.yandex.ru/security/app-passwords
   - –°–æ–∑–¥–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è "LootLink"
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å

3. **–û–±–Ω–æ–≤–∏—Ç–µ .env –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
```bash
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
EMAIL_HOST=smtp.yandex.ru
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=lootlink@yandex.ru
EMAIL_HOST_PASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å_–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è_—Å—é–¥–∞
DEFAULT_FROM_EMAIL=LootLink <lootlink@yandex.ru>
```

---

### 2. üì¨ MAIL.RU

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ 1000 –ø–∏—Å–µ–º/–¥–µ–Ω—å
- ‚úÖ –•–æ—Ä–æ—à–∞—è –¥–æ—Å—Ç–∞–≤–ª—è–µ–º–æ—Å—Ç—å –≤ –†–æ—Å—Å–∏–∏

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**

1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: https://mail.ru
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ "–í–Ω–µ—à–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"

```bash
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
EMAIL_HOST=smtp.mail.ru
EMAIL_PORT=465
EMAIL_USE_SSL=True  # –í–Ω–∏–º–∞–Ω–∏–µ: SSL, –Ω–µ TLS!
EMAIL_USE_TLS=False
EMAIL_HOST_USER=lootlink@mail.ru
EMAIL_HOST_PASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å
DEFAULT_FROM_EMAIL=LootLink <lootlink@mail.ru>
```

**–í–ê–ñ–ù–û:** –î–ª—è Mail.ru –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ settings.py:
```python
EMAIL_USE_SSL = config('EMAIL_USE_SSL', default=False, cast=bool)
```

---

### 3. üìß GMAIL (–î–ª—è –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–ª—è–µ–º–æ—Å—Ç—å
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç "App Password"

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**

1. **–°–æ–∑–¥–∞–π—Ç–µ Gmail –∞–∫–∫–∞—É–Ω—Ç**

2. **–í–∫–ª—é—á–∏—Ç–µ 2FA:**
   - Google Account ‚Üí Security ‚Üí 2-Step Verification

3. **–°–æ–∑–¥–∞–π—Ç–µ App Password:**
   - Google Account ‚Üí Security ‚Üí App Passwords
   - –í—ã–±–µ—Ä–∏—Ç–µ "Mail" –∏ "Other (Custom name)" ‚Üí "LootLink"
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ 16-–∑–Ω–∞—á–Ω—ã–π –ø–∞—Ä–æ–ª—å

```bash
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your_email@gmail.com
EMAIL_HOST_PASSWORD=–≤–∞—à_app_password_16_—Å–∏–º–≤–æ–ª–æ–≤
DEFAULT_FROM_EMAIL=LootLink <your_email@gmail.com>
```

---

### 4. üöÄ SENDGRID (–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ 100 –ø–∏—Å–µ–º/–¥–µ–Ω—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ
- ‚úÖ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- ‚úÖ –í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç–∞–≤–ª—è–µ–º–æ—Å—Ç—å
- ‚úÖ API –≤–º–µ—Å—Ç–æ SMTP

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**

1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: https://sendgrid.com
2. –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: `pip install sendgrid`

```bash
EMAIL_BACKEND=sendgrid_backend.SendgridBackend
SENDGRID_API_KEY=–≤–∞—à_api_–∫–ª—é—á_—Å—é–¥–∞
DEFAULT_FROM_EMAIL=noreply@lootlink.com
```

**settings.py:**
```python
if config('SENDGRID_API_KEY', default=''):
    EMAIL_BACKEND = 'sendgrid_backend.SendgridBackend'
    SENDGRID_API_KEY = config('SENDGRID_API_KEY')
```

---

## üõ†Ô∏è –ü–û–®–ê–ì–û–í–ê–Ø –£–°–¢–ê–ù–û–í–ö–ê (YANDEX - –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

### –®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ email –Ω–∞ Yandex

```bash
1. –û—Ç–∫—Ä–æ–π—Ç–µ https://mail.yandex.ru
2. –ù–∞–∂–º–∏—Ç–µ "–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç"
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É (–Ω–∞–ø—Ä–∏–º–µ—Ä: lootlink.marketplace@yandex.ru)
4. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —á–µ—Ä–µ–∑ SMS
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ https://id.yandex.ru/security
2. –í–∫–ª—é—á–∏—Ç–µ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "–ü–∞—Ä–æ–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π"
4. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –¥–ª—è "LootLink"
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å (–æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑!)
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç–µ .env –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh root@91.218.245.178

# –†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env
cd /opt/lootlink
nano .env

# –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é Email Settings –∏ –∏–∑–º–µ–Ω–∏—Ç–µ:
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
EMAIL_HOST=smtp.yandex.ru
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=lootlink.marketplace@yandex.ru
EMAIL_HOST_PASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å_–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è_–∏–∑_—à–∞–≥–∞_2
DEFAULT_FROM_EMAIL=LootLink Marketplace <lootlink.marketplace@yandex.ru>

# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ (Ctrl+O, Enter, Ctrl+X)
```

### –®–∞–≥ 4: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Django

```bash
sudo systemctl restart lootlink
sudo systemctl status lootlink
```

### –®–∞–≥ 5: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫—É

```bash
cd /opt/lootlink
source venv/bin/activate
python manage.py shell

# –í shell –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
from core.email_service import EmailService
results = EmailService.test_email_configuration()
print(results)

# –ï—Å–ª–∏ test_passed=True - –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç!
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï EMAIL

### –¢–µ—Å—Ç 1: –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Django shell

```python
python manage.py shell

from django.core.mail import send_mail
from django.conf import settings

# –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ —Å–µ–±–µ
send_mail(
    'Test from LootLink',
    'If you received this, email works!',
    settings.DEFAULT_FROM_EMAIL,
    ['your_email@example.com'],  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à email
    fail_silently=False
)

# –ï—Å–ª–∏ –æ—à–∏–±–æ–∫ –Ω–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É!
```

### –¢–µ—Å—Ç 2: –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è

```bash
1. –û—Ç–∫—Ä–æ–π—Ç–µ http://91.218.245.178/accounts/password-reset/
2. –í–≤–µ–¥–∏—Ç–µ email –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É - –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–π—Ç–∏ –∫–æ–¥
4. –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
```

### –¢–µ—Å—Ç 3: –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è email

```bash
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É - –¥–æ–ª–∂–Ω–∞ –ø—Ä–∏–π—Ç–∏ —Å—Å—ã–ª–∫–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
3. –ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ
4. –ê–∫–∫–∞—É–Ω—Ç –¥–æ–ª–∂–µ–Ω –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å—Å—è
```

---

## üîß TROUBLESHOOTING

### –ü—Ä–æ–±–ª–µ–º–∞: "SMTPAuthenticationError"

**–†–µ—à–µ–Ω–∏–µ:**
```
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å EMAIL_HOST_USER (–ø–æ–ª–Ω—ã–π email)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ EMAIL_HOST_PASSWORD (–¥–ª—è Gmail - App Password, –¥–ª—è Yandex - –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ 2FA –≤–∫–ª—é—á–µ–Ω–∞ (–¥–ª—è Gmail –∏ Yandex)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ EMAIL_USE_TLS=True
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Connection refused"

**–†–µ—à–µ–Ω–∏–µ:**
```
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ EMAIL_HOST –∏ EMAIL_PORT
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall: sudo ufw allow out 587/tcp
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª (TLS vs SSL)
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–∏—Å—å–º–∞ —É—Ö–æ–¥—è—Ç –≤ SPAM

**–†–µ—à–µ–Ω–∏–µ:**
```
1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SPF record –¥–ª—è –¥–æ–º–µ–Ω–∞
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ DKIM –ø–æ–¥–ø–∏—Å—å
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π email –¥–æ–º–µ–Ω (@yandex.ru –ª—É—á—à–µ —á–µ–º @mail.ru)
4. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–æ–≤–∞ "—Ç–µ—Å—Ç", "test" –≤ subject
5. –î–æ–±–∞–≤—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é unsubscribe
```

### –ü—Ä–æ–±–ª–µ–º–∞: "SMTPServerDisconnected"

**–†–µ—à–µ–Ω–∏–µ:**
```
1. –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–∏—Å–µ–º –≤ –∫–æ—Ä–æ—Ç–∫–∏–π –ø–µ—Ä–∏–æ–¥
2. –î–æ–±–∞–≤—å—Ç–µ –∑–∞–¥–µ—Ä–∂–∫—É –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∫–∞–º–∏
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Celery –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
4. –£–≤–µ–ª–∏—á—å—Ç–µ –ª–∏–º–∏—Ç –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
```

---

## üìä –õ–ò–ú–ò–¢–´ –ü–†–û–í–ê–ô–î–ï–†–û–í

| –ü—Ä–æ–≤–∞–π–¥–µ—Ä | –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ª–∏–º–∏—Ç | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è |
|-----------|------------------|-------------|
| Yandex | 500 –ø–∏—Å–µ–º/–¥–µ–Ω—å | –¢—Ä–µ–±—É–µ—Ç—Å—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–æ–º–µ–Ω–∞ –¥–ª—è >500 |
| Mail.ru | 1000 –ø–∏—Å–µ–º/–¥–µ–Ω—å | –ú–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞ —Å–ø–∞–º |
| Gmail | 500 –ø–∏—Å–µ–º/–¥–µ–Ω—å | –¢—Ä–µ–±—É–µ—Ç—Å—è App Password |
| SendGrid | 100 –ø–∏—Å–µ–º/–¥–µ–Ω—å | –¢—Ä–µ–±—É–µ—Ç—Å—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è |
| Mailgun | 100 –ø–∏—Å–µ–º/–¥–µ–Ω—å | –¢—Ä–µ–±—É–µ—Ç—Å—è –∫—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞ |

---

## üéØ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò –î–õ–Ø PRODUCTION

### 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Celery –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏

–í `core/tasks.py` —É–∂–µ –µ—Å—Ç—å:
```python
@shared_task
def send_email_async(subject, message, recipient_email):
    # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
```

### 2. –î–æ–±–∞–≤—å—Ç–µ retry –º–µ—Ö–∞–Ω–∏–∑–º

```python
# –í settings.py
EMAIL_MAX_RETRIES = 3
EMAIL_RETRY_DELAY = 60  # —Å–µ–∫—É–Ω–¥
```

### 3. –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ –æ—Ç–ø—Ä–∞–≤–∫–∏

```python
# –í–∫–ª—é—á–µ–Ω–æ –≤ SecurityAuditLog
```

### 4. –°–æ–∑–¥–∞–π—Ç–µ email templates

```bash
templates/emails/
  - password_reset.html
  - email_verification.html
  - purchase_notification.html
  - etc.
```

---

## üöÄ –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢ (5 –ú–ò–ù–£–¢)

**–î–ª—è —Å—Ä–æ—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Yandex:**

```bash
# 1. –°–æ–∑–¥–∞–π—Ç–µ email: lootlink.marketplace@yandex.ru

# 2. –ü–æ–ª—É—á–∏—Ç–µ –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ https://id.yandex.ru/security/app-passwords

# 3. SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ –æ–±–Ω–æ–≤–∏—Ç–µ .env:
ssh root@91.218.245.178
cd /opt/lootlink
nano .env

# –í—Å—Ç–∞–≤—å—Ç–µ:
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
EMAIL_HOST=smtp.yandex.ru
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=lootlink.marketplace@yandex.ru
EMAIL_HOST_PASSWORD=–≤—Å—Ç–∞–≤—å—Ç–µ_—Å—é–¥–∞_–ø–∞—Ä–æ–ª—å_–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
DEFAULT_FROM_EMAIL=LootLink <lootlink.marketplace@yandex.ru>

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:
sudo systemctl restart lootlink

# 5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ:
cd /opt/lootlink && source venv/bin/activate
python manage.py shell
>>> from core.email_service import EmailService
>>> EmailService.test_email_configuration()
```

**–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å email —Ä–∞–±–æ—Ç–∞–µ—Ç!** üéâ

---

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

–ï—Å–ª–∏ email –≤—Å—ë –µ—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `sudo journalctl -u lootlink -n 100`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª: `cat /opt/lootlink/.env | grep EMAIL`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç: `ping smtp.yandex.ru`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall: `sudo ufw status`

---

## üí° –°–û–í–ï–¢–´ –î–õ–Ø –ú–ê–°–®–¢–ê–ë–ò–†–û–í–ê–ù–ò–Ø

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å—Ç–∞–Ω–µ—Ç –º–Ω–æ–≥–æ (1000+):

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å:**
   - SendGrid (–¥–æ 40,000 –ø–∏—Å–µ–º/–º–µ—Å –±–µ—Å–ø–ª–∞—Ç–Ω–æ —Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π)
   - Mailgun (pay-as-you-go)
   - AWS SES (–æ—á–µ–Ω—å –¥–µ—à–µ–≤–æ, $0.10 –∑–∞ 1000 –ø–∏—Å–µ–º)

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–≤–æ–π –¥–æ–º–µ–Ω:**
   - –ö—É–ø–∏—Ç–µ –¥–æ–º–µ–Ω (lootlink.ru)
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SPF, DKIM, DMARC
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ email@lootlink.ru –≤–º–µ—Å—Ç–æ @yandex.ru

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ bounce rate
   - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–∏—Å–µ–º
   - –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–ø–∞–º-—Ä–µ–ø—É—Ç–∞—Ü–∏—é

---

## ‚ö° –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê

–Ø —Å–æ–∑–¥–∞–ª —Å–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
cd /opt/lootlink
chmod +x scripts/setup_email.sh
./scripts/setup_email.sh
```

–°–∫—Ä–∏–ø—Ç —Å–ø—Ä–æ—Å–∏—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç –≤—Å—ë –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

